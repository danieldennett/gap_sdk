<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GAP8 BenchMark Test Suite</title>
<title>GAP8 BenchMark Test Suite</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="pulp.css" rel="stylesheet" type="text/css" />
<link href="gap.css" rel="stylesheet" type="text/css" />
<link href="images.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="titlerow">
  <td id="projectlogo"><img alt="Logo" src="gap-logo-55.png" /></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">GAP8 BenchMarks</div>
    </td>
  <td id="extralogo"><img alt="GreenWaves" src="greenwaves-logo-55.png" /></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GAP8 BenchMark Test Suite </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section0"></a>
GAP8 CNN Benchmarks</h1>
<p>The GAP8 CNN Benchmark package provides a test suite to evaluate the performance and energy efficiency of GAP8's cluster on a representative subset of Convolution Neural Networks (CNN) Layers. This guide shows you how to run the benchmarks and check cycle and energy results.</p>
<h2><a class="anchor" id="section1"></a>
Benchmarks Description</h2>
<p>Here the list of benchmarks in this test suite:</p>
<ul>
<li>2x2 stride 2 Max Pooling Layer</li>
<li>2x2 stride 2 Average Pooling Layer</li>
<li>5x5 stride 1 Convolutional Layer</li>
<li>5x5 stride 1 Xnor Convolutional Layer</li>
<li>Linear (Fully Connected) Layer</li>
</ul>
<p>The benchmarks can be executed in 2 scenarios:</p>
<ol type="1">
<li>Pure RISC-V Standard ISA - Provides a baseline performance for a non-optimised core.</li>
<li>GAP8 ISA (RISC-V Std ISA + Gap8 ISA extensions *)<ul>
<li>Single Core</li>
<li>Single Core with Vectorization (Byte or Short)</li>
<li>Parallel (8 Cores) with Vectorization (Byte or Short)</li>
</ul>
</li>
</ol>
<p>Each GAP8 Cluster core embeds a vector unit capable of 4 byte operations or 2 short operations per cycle*.</p>
<ul>
<li>A list of all ISA extensions of GAP8 can be found in section "Device components description" of the <a href="https://greenwaves-technologies.com/sdk-manuals/">GAP8 Reference Manual</a></li>
</ul>
<h2><a class="anchor" id="section2"></a>
Benchmarks Results</h2>
<p>The performance and energy results measured on the GAPuino Board are reported in this section. In following sections we explain how to reproduce these results with your GAPuino Board.</p>
<p>The following chart shows the execution time speed-up of GAP8. The baseline is the Pure RISC-V ISA. All the experiment were conducted on a GAPuino Board.</p>
<div class="image">
<img src="images/compute.png" title="Compute Comparison"/>
</div>
<p>As we can see GAP8 benefits from all the 3 optimization steps. The speed up of GAP8 ISA extensions, vectorization and parallelization is between 14.5x and 53.9x. Which means that for instance at max GAP8 frequency <b>for a 5x5 byte convolutional layer on a 112x112 grayscale input image with 100 output filters, on GAP8 it takes only 12.8 ms while on a single core standard RISC-V ISA 729.4 ms</b>.</p>
<p>The next analysis shows the energy efficiency gain with respect to pure RISC-V Standard ISA.</p>
<div class="image">
<img src="images/energy.png" title="Energy Comparison"/>
</div>
<p>Here the results shows that for a given benchmark, we have a benefit from the GAP8 ISA extensions (blue bar), from the vector units (red bar) and from parallelism (yellow bar). The parallelism, exploiting shared instruction cache and shared memory, gives an additional <sub>2x gain in energy efficiency.</sub></p>
<p><sub></sub></p>
<h2><a class="anchor" id="section3"></a>
How to run the Benchmarks</h2>
<p><sub> To run the benchmarks with RISC-V Std ISA + Gap8 ISA extensions you can just type:</sub></p>
<p><sub></p><div class="fragment"><div class="line">$ make clean all run</div></div><!-- fragment --><p></sub></p>
<p><sub>This will be the output that you get:</sub></p>
<p><sub></p><div class="fragment"><div class="line">                      --------------------------------------------------------</div><div class="line">                      --------------------------------------------------------</div><div class="line">                      ---------------   GAP8 benchmarks   --------------------</div><div class="line">                      --------------------------------------------------------</div><div class="line">                      --------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">Gap8 Input Voltage    : 1.2 Volts</div><div class="line">Fabric Controller Freq: 250 MhZ</div><div class="line">Cluster  Freq         : 175 MhZ</div><div class="line"></div><div class="line"></div><div class="line">Number of iterations for each benchmark: 100</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">                      ---------------        Sequential   ---------------</div><div class="line">                2x2/2 Max Pool Input: 112x112 (x100 iterations) Time:      14557 uSec. Cycles:    2573762</div><div class="line">                2x2/2 Avg Pool Input: 112x112 (x100 iterations) Time:      14527 uSec. Cycles:    2573659</div><div class="line">              5x5 Convolutions Input: 112x112 (x100 iterations) Time:     520813 uSec. Cycles:   92241320</div><div class="line">                        Linear Input: 1024x16 (x100 iterations) Time:      32532 uSec. Cycles:    5765099</div><div class="line">                 Xnor Conv 5x5 Input: 100x100 (x100 iterations) Time:      80994 uSec. Cycles:   14349428</div><div class="line"></div><div class="line">                      ---------------            Vector   ---------------</div><div class="line">                2x2/2 Max Pool Input: 112x112 (x100 iterations) Time:      16174 uSec. Cycles:    2864082</div><div class="line">                2x2/2 Avg Pool Input: 112x112 (x100 iterations) Time:      12696 uSec. Cycles:    2249276</div><div class="line">              5x5 Convolutions Input: 112x112 (x100 iterations) Time:     100067 uSec. Cycles:   17741015</div><div class="line">                        Linear Input: 1024x16 (x100 iterations) Time:       8270 uSec. Cycles:    1465880</div><div class="line"></div><div class="line">                      ---------------          Parallel   ---------------</div><div class="line">                2x2/2 Max Pool Input: 112x112 (x100 iterations) Time:       2167 uSec. Cycles:     382837</div><div class="line">                2x2/2 Avg Pool Input: 112x112 (x100 iterations) Time:       2136 uSec. Cycles:     380589</div><div class="line">              5x5 Convolutions Input: 112x112 (x100 iterations) Time:      72052 uSec. Cycles:   12810568</div><div class="line">                        Linear Input: 1024x16 (x100 iterations) Time:       4425 uSec. Cycles:     790475</div><div class="line">                 Xnor Conv 5x5 Input: 100x100 (x100 iterations) Time:       9704 uSec. Cycles:    1729797</div><div class="line"></div><div class="line">                      ---------------   Parallel Vector   ---------------</div><div class="line">                2x2/2 Max Pool Input: 112x112 (x100 iterations) Time:       2014 uSec. Cycles:     355563</div><div class="line">                2x2/2 Avg Pool Input: 112x112 (x100 iterations) Time:       1861 uSec. Cycles:     332328</div><div class="line">              5x5 Convolutions Input: 112x112 (x100 iterations) Time:      12848 uSec. Cycles:    2281309</div><div class="line">                        Linear Input: 1024x16 (x100 iterations) Time:       1252 uSec. Cycles:     223484</div></div><!-- fragment --><p></sub></p>
<p><sub></sub></p>
<h3><a class="anchor" id="section4"></a>
To run the benchmarks in pure RISC-V Standard ISA mode (only single core)</h3>
<p><sub> </p><div class="fragment"><div class="line">make clean all run RISCV_FLAGS=&quot;-march=rv32imc -DRISCV&quot;</div></div><!-- fragment --><p></sub></p>
<p><sub></sub></p>
<h3><a class="anchor" id="section5"></a>
Change Benchmarks Parameters</h3>
<p><sub> To switch input data between Byte and Short a define has been placed at beginning of AllTest.c file. Comment it out to test it with shorts.</sub></p>
<p><sub></p><div class="fragment"><div class="line">#define BYTE</div></div><!-- fragment --><p></sub></p>
<p><sub>To change the number of iterations executed by each benchmark you can change the value of this define:</sub></p>
<p><sub></p><div class="fragment"><div class="line">#define ITERATIONS 100</div></div><!-- fragment --><p></sub></p>
<p><sub>To change Fabric Controller and Cluster Frequencies you can use following defines. Both of then can be powered at 1 or 1.2 Volts.</sub></p>
<p><sub></p><div class="fragment"><div class="line"><span class="preprocessor">#define ALIM_1_VOLT 1</span></div><div class="line"><span class="preprocessor">#define FREQ_FC (50 * 1000000)</span></div><div class="line"><span class="preprocessor">#define FREQ_CL (50 * 1000000)</span></div></div><!-- fragment --><p></sub></p>
<p><sub>Here is a table of the supported maximum frequencies:</sub></p>
<p><sub></p><table class="doxtable">
<tr>
<th>Input Voltage </th><th>Fabric Controller Max Freq </th><th>Cluster Max Freq  </th></tr>
<tr>
<td>1.0 V </td><td>150 MhZ </td><td>90 MhZ </td></tr>
<tr>
<td>1.2 V </td><td>250 MhZ </td><td>175 MhZ </td></tr>
</table>
<p></sub></p>
<p><sub></sub></p>
<h2><a class="anchor" id="section6"></a>
How to measure Power Consumption on the GAPuino Board</h2>
<p><sub> The energy consumed by each benchmark can be measured using a differential probe connected to an oscilloscope. The differential probe is connected to the tests point 5 and 6 (TP5 and TP6). A 1 Ohm resistor is already placed between the two test points on the board. Before each kernel is launched the benchmark asserts the GPIO 17 and once each single benchmark is finished de-asserts it. So this GPIO can be used as trigger for the energy measurements. In the following figure a description of the physical pins on Gapuino board:</sub></p>
<p><sub></p><div class="image">
<img src="images/bechmarkSetup.png" title="Gapuino Energy Measurements"/>
</div>
<p></sub></p>
<p><sub>To enable the GPIO PIN this define should be commented out:</sub></p>
<p><sub></p><div class="fragment"><div class="line"><span class="preprocessor">#define NOGPIO</span></div></div><!-- fragment --><p></sub></p>
<p><sub>The results presented in the previous section are sampled with a PicoScope 4444 using 1 probe connected to GPIO 17 and 1 differential probe to measure the voltage drop. The voltage drop can be directly converted to current thanks to the 1 Ohm resistor (I = V / R, where R is 1).</sub></p>
<p><sub>Here an example of the PicoScope output screen of the benchmarks:</sub></p>
<p><sub></p><div class="image">
<img src="images/pico.png" title="Gapuino PicoScope Output"/>
</div>
<p></sub></p>
<p><sub>The GPIO indicates the starting and ending point of each benchmark. </sub></p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jan 24 2020 12:47:55 for  by GreenWaves Technologies
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 
	-->
	</li>
  </ul>
</div>
</body>
</html>
